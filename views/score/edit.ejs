<script>
      'use strict';
      window.onload = function() {
      angular.module('myApp',['ngRoute'])
          .controller('scoreCtrl', function ($scope) {
      var initialServerData = <%if(!score.measures.length===0) { %> <%= score.measures %> <% } else { %> {} <% } %>;
      $scope.selected = "create";
      $scope.measures = initialServerData || [];
      $scope.measureNumber = 0;
      $scope.measureValue = new String("");
      
      /*if (!io.socket.alreadyListeningToMeasures) {
        io.socket.alreadyListeningToMeasures = true;
        io.socket.on('score', function onServerSentEvent (msg) {
    	  console.log(msg);
          // Let's see what the server has to say...
          switch(msg.verb) {
    
            case 'created':
              //$scope.measures.push(msg.data); // (add the new order to the DOM)
              //$scope.$apply(); 
              // (re-render)
              break;
    		    case 'updated':
    			// handle update
    			break;
            default: return; // ignore any unrecognized messages
          }
        });
      }*/
      $scope.kickoff = function() {
        console.log($scope.selected);
        switch($scope.selected) {
          case "create":
            $scope.create();
          case "update":
            $scope.update();
          case "destroy":
            $scope.destroy();
        }
        
      }
       $scope.update = function() {
      	io.socket.post('/measure/update', {owner: <%=score.id%>, measureNumber: $scope.measureNumber, measureValue: $scope.measureValue }, function (resData, jwRes) {
    	    jwRes.statusCode; // => 200
    	    console.log(resData);
    	    console.log(jwRes);
    	  });
    
      }
      $scope.create = function() {
        var obj = {owner: <%=score.id%>, measureNumber: $scope.measureNumber, measureValue: $scope.measureValue};
        console.log(obj);
      	/*io.socket.post('/measure/create', obj, function (resData, jwRes) {
      	  console.log(resData);
    	    console.log(jwRes);
      	});*/
      }
      $scope.destroy = function() {
        io.socket.post('/measure/destroy', {owner: <%=score.id%>, measureNumber: $scope.measureNumber, measureValue: $scope.measureValue}, function(resData, jwRes) {
      	  console.log(resData);
    	    console.log(jwRes);
        });
      };
    });
    
    io.socket.on('connect', function() {
      io.socket.get('/score/joinRoom/'+<%=score.id%>, function(resData, jwres) {console.log(resData);});
      //var abc_editor = new ABCJS.Editor("abc", { paper_id: "paper0", midi_id:"midi", warnings_id:"warnings" });
    });
  };
</script>
<div ng-app="myApp" ng-controller="scoreCtrl">
<textarea name="abc" id="abc" cols="80" rows="15">X: 1
T: Cooley's
M: 4/4
L: 1/8
R: reel
K: Emin
|:D2|EB{c}BA B2 EB|~B2 AB dBAG|FDAD BDAD|FDAD dAFD|
EBBA B2 EB|B2 AB defg|afe^c dBAF|DEFD E2:|
|:gf|eB B2 efge|eB B2 gedB|A2 FA DAFA|A2 FA defg|
eB B2 eBgB|eB B2 defg|afe^c dBAF|DEFD E2:|
</textarea>
<div id="midi"></div>
<div id="warnings"></div>
<div id="music"></div>
<div id="paper0"></div>
<div id="paper1"></div>
<div id="paper2"></div>
<div id="paper3"></div>
  <input type="radio" ng-model="selected" name="action" ng-value="create">
  <input type="radio" ng-model="selected" name="action" ng-value="update">
  <input type="radio" ng-model="selected" name="action" ng-value="destroy">


  <input type="number" ng-model="measureNumber" required>
  <input type="text" ng-model="measureValue" required>
  <button ng-click="kickoff()">Go</button>
</div>